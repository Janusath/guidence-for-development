how to setup the database backup using (composer require spatie/laravel-backup) package


    1.install the command :  composer require spatie/laravel-backup
           * it will update the some changes in composer.json,composer.lock
    2 To publish the config file to config/backup.php run:  php artisan vendor:publish --provider="Spatie\Backup\BackupServiceProvider" --tag=backup-config
           * it will add the backup.php file in config folder 
    3 Add this package for google drive access:   composer require masbug/flysystem-google-drive-ext

    4 add this in the config->filesystems.php

       'google' => [
            'driver' => 'google',
            'clientId' => env('GOOGLE_DRIVE_CLIENT_ID'),
            'clientSecret' => env('GOOGLE_DRIVE_CLIENT_SECRET'),
            'refreshToken' => env('GOOGLE_DRIVE_REFRESH_TOKEN'),
            'folderId' => env('GOOGLE_DRIVE_FOLDER_ID'),
        ],

   6 add this config->backup.php

           'disks' => [
                'local',
                'google',
            ],

   7 add .env 

      GOOGLE_DRIVE_CLIENT_ID=555226254005-p83548bkog17bok8k0lnfht3hgr9hjrl.apps.googleusercontent.com
      GOOGLE_DRIVE_CLIENT_SECRET=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
      GOOGLE_DRIVE_REFRESH_TOKEN=1//04nmm51THrTITCgYIARAAGAQSNwF-L9IrGLUdO4xUpzB6AcDL_OV4gAl4TAFIDlqAtXW1-DXEwlMKy-NqIUT9YG2IPcs5f-MdwbU
      GOOGLE_DRIVE_FOLDER_ID=1ZhqbNIiqlGsdL1pGNrTAjFWGnJIIXePv

 8 add this function in ServiceProvider

                <?php
            namespace App\Providers;
            
            use Illuminate\Support\ServiceProvider;
            
            class AppServiceProvider extends ServiceProvider
            {
                /**
                 * Register any application services.
                 */
                public function register(): void
                {
                    //
                }
            
                /**
                 * Bootstrap any application services.
                 */
                public function boot()
                {
            
                    $this->DbBackup();
                }
            
                private function DbBackup()
                {
            
                    try {
                        \Storage::extend('google', function ($app, $config) {
                            $options = [];
            
                            if (! empty($config['folderId'] ?? null)) {
                                $options['folderId'] = $config['folderId'];
                            }
            
                            $client = new \Google\Client();
                            $client->setClientId($config['clientId']);
                            $client->setClientSecret($config['clientSecret']);
                            $client->refreshToken($config['refreshToken']);
            
                            $service = new \Google\Service\Drive($client);
                            $adapter = new \Masbug\Flysystem\GoogleDriveAdapter($service, $config['folder'] ?? '/', $options);
                            $driver  = new \League\Flysystem\Filesystem($adapter);
            
                            return new \Illuminate\Filesystem\FilesystemAdapter($driver, $adapter);
                        });
                    } catch (\Exception $e) {
                        \Log::error($e->getMessage());
                    }
                }
            
            }


  8 run -> php artisan backup:run --only-db



//  laravel set up is finished -----------------------------------------------------------------------------------------------------------




// in googledrive set up -----------------------------------------------------------------------------------------------------------------


  1 create the folder in google drive : 
         first folder name is laravel  then get the folder id for eample : 1bANLXLJRYjjcR-nCYn68OIpT3sRH7Vyn

  note : this folder only access for particular console authenticated email aceess drive

 
  // in https://console.cloud.google.com set up -----------------------------------------------------------------------------------------------------------------     

 1 go to this link https://console.cloud.google.com/ 

 2 create the new project like  projact-backup

 3 in sidebar -> Apis & Services ->Library

 4 search the google drive api and click and enable

 5 inside bar -> credentilas-> and click the configure constant screen -> click the get started

 6 give the app name like project-backup and select the user support email and click the next button 
      - select the external radio buton and click the next button and Contact Information email -> your login email and finished and done 
     next -> create oauth client -> select for aplication type for -> web application and give name any

 7 in Authorized redirect URIs section add this link: https://developers.google.com/oauthplayground  -> create -> download the credential 

 8 click the audience button -> click the publish app button 

 9 click the branding button -> Authorized domains section -> click the add domain button and enter -> google.com  and save 

 10 go to https://developers.google.com/oauthplayground this page 
    click the setting button and click the Use your own OAuth credentials checkbox 

    past the credential from your downloaded credential 

11 select the "Drive Api V3" 
   and select the first link  : https://www.googleapis.com/auth/drive  and click button  // it will redirect to the another page 
12 click the "Exchange code for tokens"

13 copy the refresh token and past in your laravel project-> env file 


14 run and test in local : php artisan backup:run --only-db

// everything is finished ----------------------------------------------------------------------------------------------------------






